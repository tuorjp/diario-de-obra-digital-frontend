<div class="page-card">

  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h2>Relação de Obras</h2>
      <div class="status-filters">
        <label class="filter-checkbox">
          <input type="checkbox" [(ngModel)]="filtroAtiva" (change)="onFiltroChange()" />
          Em andamento
        </label>
        <label class="filter-checkbox">
          <input type="checkbox" [(ngModel)]="filtroConcluida" (change)="onFiltroChange()" />
          Concluídas
        </label>
        <label class="filter-checkbox">
          <input type="checkbox" [(ngModel)]="filtroCancelada" (change)="onFiltroChange()" />
          Canceladas
        </label>
      </div>
    </div>
    <button class="btn-nova-obra" (click)="onNovaObra()">
      <span class="btn-plus">+</span> Nova Obra
    </button>
  </div>

  <!-- Search and Sort Controls -->
  <div class="controls-bar">
    <div class="search-group">
      <div class="search-input-wrap">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
          viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
        <input type="text" class="search-input" placeholder="Pesquisar" [(ngModel)]="termoBusca"
          (input)="onBuscaChange()" />
      </div>
      <div class="sort-select-wrap">
        <select class="sort-select" [(ngModel)]="sortField" (change)="onSortChange()">
          <option value="projeto">Por nome</option>
          <option value="id">Por código</option>
          <option value="status">Por status</option>
          <option value="contratante">Por contratante</option>
        </select>
        <svg class="select-chevron" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none"
          viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <polyline points="6 9 12 15 18 9" />
        </svg>
      </div>
    </div>
    <button class="btn-sort-code" (click)="toggleSortDir()">
      Ordenar por código
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2">
        <line x1="8" y1="6" x2="21" y2="6" />
        <line x1="8" y1="12" x2="21" y2="12" />
        <line x1="8" y1="18" x2="21" y2="18" />
        <line x1="3" y1="6" x2="3.01" y2="6" />
        <line x1="3" y1="12" x2="3.01" y2="12" />
        <line x1="3" y1="18" x2="3.01" y2="18" />
      </svg>
    </button>
  </div>

  <!-- Table -->
  @if (loading()) {
  <div class="status-state">
    <div class="spinner"></div>
    <p>Carregando obras...</p>
  </div>
  } @else if (error()) {
  <p class="status-msg error">{{ error() }}</p>
  } @else {
  <div class="table-wrapper">
    <table class="tabela-obras">
      <thead>
        <tr>
          <th class="col-contrato">Contrato</th>
          <th class="col-nome">Nome</th>
          <th class="col-cidade">Cidade</th>
          <th class="col-status">Status</th>
          <th class="col-data">Data Início</th>
          <th class="col-acoes">Ações</th>
        </tr>
      </thead>
      <tbody>
        @if (obras().length === 0) {
        <tr>
          <td colspan="6" class="empty-row">Nenhuma obra encontrada.</td>
        </tr>
        }
        @for (obra of obras(); track obra.id) {
        <tr>
          <td class="col-contrato">{{ obra.id }}</td>
          <td class="col-nome">{{ obra.projeto }}</td>
          <td class="col-cidade">{{ obra.contratante }}</td>
          <td class="col-status">
            <span class="badge" [ngClass]="getStatusClass(obra.status)">
              {{ getStatusLabel(obra.status) }}
            </span>
          </td>
          <td class="col-data">{{ formatDate(obra.dataInicio) }}</td>
          <td class="col-acoes">
            <button class="action-btn" title="Ver diários" (click)="onVerDiarios(obra)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="1.8">
                <path d="M4 19.5A2.5 2.5 0 016.5 17H20" />
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z" />
              </svg>
            </button>
            <button class="action-btn" title="Visualizar" (click)="onVisualizar(obra)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="1.8">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
            </button>
            <button class="action-btn" title="Editar" (click)="onEditar(obra)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="1.8">
                <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" />
                <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />
              </svg>
            </button>
            <button class="action-btn action-btn--delete" title="Excluir" (click)="onExcluir(obra)">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="1.8">
                <polyline points="3 6 5 6 21 6" />
                <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6" />
                <path d="M10 11v6M14 11v6" />
                <path d="M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2" />
              </svg>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <button class="page-btn" (click)="goToPage(0)" [disabled]="currentPage() === 0" title="Primeira página">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2.5">
        <polyline points="11 17 6 12 11 7" />
        <polyline points="18 17 13 12 18 7" />
      </svg>
    </button>
    <button class="page-btn" (click)="goToPage(currentPage() - 1)" [disabled]="currentPage() === 0"
      title="Página anterior">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2.5">
        <polyline points="15 18 9 12 15 6" />
      </svg>
    </button>
    <span class="page-info">{{ currentPage() + 1 }} de {{ totalPages() }}</span>
    <button class="page-btn" (click)="goToPage(currentPage() + 1)" [disabled]="currentPage() >= totalPages() - 1"
      title="Próxima página">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2.5">
        <polyline points="9 18 15 12 9 6" />
      </svg>
    </button>
    <button class="page-btn" (click)="goToPage(totalPages() - 1)" [disabled]="currentPage() >= totalPages() - 1"
      title="Última página">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" stroke-width="2.5">
        <polyline points="13 17 18 12 13 7" />
        <polyline points="6 17 11 12 6 7" />
      </svg>
    </button>
  </div>
  }
</div>